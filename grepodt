#!/bin/bash
name=$(basename $0)
DIR2CHK=.
which odt2txt >/dev/null || {
  echo "first install the odt2txt package"; exit 1
}

[ $# -ne 2 ] && {
  echo "Usage: ${name} regex directory-to-check"
  exit 1
}
TOP=$(pwd)
DIR2CHK=$2
echo "regex=$1 DIR2CHK=${DIR2CHK}"

cd ${DIR2CHK}

TMPDIR=/tmp/${name}  #$(mktemp -d)
rm -rf ${TMPDIR}
#for f in $(find ${DIR2CHK} -maxdepth 2 -name "*.odt" 2>/dev/null)

echo "Generating ODT->TXT (via idt2txt) now, pl wait ..."
for f in $(find ${DIR2CHK} -name "*.odt" 2>/dev/null)
do
  [ ! -f ${f} ] && continue
  #echo "f: ${f}"
  mkdir -p ${TMPDIR}/$(dirname ${f})
  cmd="odt2txt ${f} > ${TMPDIR}/$(dirname ${f})/$(basename ${f}).txt" #2>/dev/null
  #echo ${cmd}
  echo -n "."
  eval ${cmd}
done
echo

GOPTS="-iHnC1 --color"
for f in $(find ${TMPDIR} -name "*.txt" 2>/dev/null)
do
  \grep ${GOPTS} "${1}" ${TMPDIR}/*.txt 2>/dev/null
done

rm -rf ${TMPDIR}
cd ${TOP}
exit 0
